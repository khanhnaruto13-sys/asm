<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="shared/layout :: layout(~{::body})">

<body>

<h2 class="mb-4 text-center">Giỏ hàng</h2>

<div class="px-3 px-md-4">

    <table class="table table-bordered align-middle text-center shadow-sm">
        <thead class="table-light">
        <tr>
            <th>Hình ảnh</th>
            <th>Tên</th>
            <th>Giá</th>
            <th>SL</th>
            <th>Thành tiền</th>
            <th></th>
        </tr>
        </thead>

        <tbody>
        <!-- DANH SÁCH SẢN PHẨM -->
        <tr th:each="item : ${items}">
            <td>
                <img th:src="${item.product.image}" width="70">
            </td>

            <td th:text="${item.product.name}"></td>

            <td th:text="${#numbers.formatDecimal(item.product.price,0,'COMMA',0,'POINT')} + 'đ'"></td>

            <!-- SỐ LƯỢNG -->
            <td>
                <form th:action="@{/cart/update}" method="post"
                      class="d-flex justify-content-center">
                    <input type="hidden" name="itemId" th:value="${item.id}">
                    <input type="number"
                           name="quantity"
                           th:value="${item.quantity}"
                           min="1"
                           class="form-control form-control-sm text-center"
                           style="width: 70px"
                           onchange="this.form.submit()">
                </form>
            </td>

            <!-- THÀNH TIỀN -->
            <td th:text="${#numbers.formatDecimal(item.product.price * item.quantity,0,'COMMA',0,'POINT')} + 'đ'"></td>

            <!-- XOÁ 1 SP -->
            <td>
                <a th:href="@{'/cart/delete/' + ${item.id}}"
                   class="btn btn-danger btn-sm">
                    Xoá
                </a>
            </td>
        </tr>

        <!-- GIỎ TRỐNG -->
        <tr th:if="${#lists.isEmpty(items)}">
            <td colspan="6" class="text-center text-muted">
                Giỏ hàng đang trống
            </td>
        </tr>
        </tbody>
    </table>

    <!-- TỔNG TIỀN + BUTTON -->
    <div class="d-flex justify-content-between align-items-center mt-3">

        <h5>
            Tổng tiền:
            <strong th:text="${#numbers.formatDecimal(total,0,'COMMA',0,'POINT')} + 'đ'"></strong>
        </h5>

        <div class="d-flex gap-2">
            <a href="/cart/clear"
               class="btn btn-outline-danger"
               th:if="${!#lists.isEmpty(items)}">
                Xoá tất cả
            </a>

            <a href="/cart/checkout"
               class="btn btn-success"
               th:if="${!#lists.isEmpty(items)}">
                Thanh toán
            </a>
        </div>
    </div>

</div>

</body>
</html>
